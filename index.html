<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>
    <script>
var score = 0;
var scoreText;
var cursors;
var player;
var rocks;
var logs;
var direction;
var time;
var beaver = 'norb';
var lives = [];

class SceneA extends Phaser.Scene {

  constructor ()
  {
      super('SceneA');
  }

  preload(){
    this.load.image('Norbert', 'assets/images/Norbert.png');
    this.load.image('Daggett', 'assets/images/Daggett.png');
    this.load.image('Dam', 'assets/images/beaverDam.jpg');
  }

  create(){
    cursors = this.input.keyboard.createCursorKeys();
    var dam = this.add.image(370, 290, 'Dam');

    dam.displayWidth = 750;
    dam.scaleY = dam.scaleX;

    var daggett = this.add.image(300, 320, 'Daggett').setInteractive();
    var norbert = this.add.image(485, 320, 'Norbert').setInteractive();
    daggett.on('pointerdown', function(){
      beaver = 'dag';
      this.scene.start('SceneB');
    },this);
    norbert.on('pointerdown', function(){
      beaver = 'norb';
      this.scene.start('SceneB');
    },this);
  }

  update(){

  }
}

class SceneB extends Phaser.Scene {
    constructor ()
    {
        super('SceneB');
    }
    preload ()
    {
        this.load.image('rock', 'assets/images/rock.png');
        this.load.image('log', 'assets/images/log.png');
        this.load.image('menuBtn', 'assets/images/menu.png');
        this.load.image('norbLife', 'assets/images/norbLife.png');
        this.load.image('dagLife', 'assets/images/dagLife.png');
        this.load.spritesheet('water', 'assets/images/watersheet.png',{ frameWidth: 370, frameHeight: 361 });
        this.load.spritesheet('norb', 'assets/images/norbsheet.png',{ frameWidth: 500, frameHeight: 500 });
        this.load.spritesheet('dag', 'assets/images/dagsheet.png',{ frameWidth: 500, frameHeight: 500 });
    }

    create ()
    {
        //reset score
        score = 0;
        // create background
        this.anims.create({
            key: 'movingwater',
            frames: this.anims.generateFrameNumbers('water', { start: 0, end: 2 }),
            frameRate: 7,
            repeat: -1
        });
        this.add.sprite(185, 181, 'water').play('movingwater');
        this.add.sprite(555, 181, 'water').play('movingwater');
        this.add.sprite(185, 542, 'water').play('movingwater');
        this.add.sprite(555, 542, 'water').play('movingwater');

        var menuBtn = this.add.image(680, 30, 'menuBtn').setInteractive();
        menuBtn.displayWidth = 80;
        menuBtn.scaleY = menuBtn.scaleX;
        menuBtn.on('pointerdown', function(){
          this.scene.start('SceneA');
        },this);

        // add rocks
        rocks = this.physics.add.staticGroup();
        rocks.create(0, 560, 'rock');
        rocks.create(60, 560, 'rock');
        rocks.create(135, 565, 'rock');
        rocks.create(215, 570, 'rock');
        rocks.create(300, 572, 'rock');
        rocks.create(358, 570, 'rock');
        rocks.create(445, 565, 'rock');
        rocks.create(500, 560, 'rock');
        rocks.create(580, 560, 'rock');
        rocks.create(680, 560, 'rock');

        logs = this.physics.add.group();

        for(var i = 0; i < 3; i++){
          var life = this.add.image(i * 32 +33, 60, beaver+'Life');
          life.displayWidth = 35;
          life.scaleY = life.scaleX;
          lives.push(life);
        }

            this.anims.create({
                key: 'norbLeft',
                frames: this.anims.generateFrameNumbers('norb', { start: 0, end: 8 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'norbUpLeft',
                frames: this.anims.generateFrameNumbers('norb', { start: 0, end: 8 }),
                frameRate: 24,
                repeat: -1
            });

            this.anims.create({
                key: 'norbRight',
                frames: this.anims.generateFrameNumbers('norb', { start: 9, end: 15 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'norbUpRight',
                frames: this.anims.generateFrameNumbers('norb', { start: 9, end: 15 }),
                frameRate: 24,
                repeat: -1
            });

            this.anims.create({
                key: 'dagLeft',
                frames: this.anims.generateFrameNumbers('dag', { start: 0, end: 8 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'dagUpLeft',
                frames: this.anims.generateFrameNumbers('dag', { start: 0, end: 8 }),
                frameRate: 24,
                repeat: -1
            });

            this.anims.create({
                key: 'dagRight',
                frames: this.anims.generateFrameNumbers('dag', { start: 9, end: 15 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'dagUpRight',
                frames: this.anims.generateFrameNumbers('dag', { start: 9, end: 15 }),
                frameRate: 24,
                repeat: -1
            });

        // create player
        player = this.physics.add.sprite(360, 210, beaver).play(beaver+'Right');
        player.setCollideWorldBounds(true);
        player.displayWidth = 65;
        player.scaleY = player.scaleX;

        // add collision events
        this.physics.add.collider(player, rocks, function(guy, rock){
          guy.enableBody(true, 360, 210, true, true)
          var life;
          if(lives.length === 0){
            this.scene.start('SceneC');
          } else {
            life = lives.pop();
            life.destroy();
          }
        }, null, this);

        this.physics.add.collider(rocks, logs, function(rock, log){
          log.disableBody(true, true)
        }, null, this);

        this.physics.add.collider(player, logs, function(guy, log){
          score += 10;
          scoreText.setText('Score: ' + score);
          log.disableBody(true, true)
        }, null, this);

        scoreText = this.add.text(16, 16, 'score: 0', { strokeThickness: 10, fontSize: '20px', fill: '#000' });
        cursors = this.input.keyboard.createCursorKeys();

        this.time.addEvent({
            delay: 2000,
            callback: ()=>{
                logs.create(Phaser.Math.Between(40, 700), 0, 'log');
            },
            loop: true
        });
    }

    update(){
      if(cursors.up.isDown && cursors.left.isDown){
          direction = 'left';
          player.setVelocityX(-160);
          player.anims.play(beaver+'UpLeft', true);
      }
      else if(cursors.up.isDown && cursors.right.isDown){
          direction = 'right';
          player.setVelocityX(160);
          player.anims.play(beaver+'UpRight', true);
      }
      else if(cursors.up.isDown && direction === 'left'){
          player.setVelocityX(0);
          player.anims.play(beaver+'UpLeft', true);
      }
      else if(cursors.up.isDown && direction === 'right'){
          player.setVelocityX(0);
          player.anims.play(beaver+'UpRight', true);
      }
      else if (cursors.left.isDown)
      {
          direction = 'left';
          player.setVelocityX(-160);
          player.anims.play(beaver+'Left', true);
      }
      else if (cursors.right.isDown)
      {
          direction = 'right';
          player.setVelocityX(160);
          player.anims.play(beaver+'Right', true);
      }
      else
      {
          if(direction === 'left'){
            player.anims.play(beaver+'Left', true);
          } else{
            player.anims.play(beaver+'Right', true);
          }
          player.setVelocityX(0);
          player.setVelocityY(150);
      }

      if (cursors.up.isDown)
      {
          player.setVelocityY(-170);
      }

      // if(player.body.touching.down){
      //   var poop = 'poop';
      // }
    }
  }

  class SceneC extends Phaser.Scene {
    constructor ()
    {
        super('SceneC');
    }

    preload ()
    {
        this.load.spritesheet('gameoversheet', 'assets/images/gameoversheet.png',{ frameWidth: 482, frameHeight: 362 });
        this.load.image('gameovertxt', 'assets/images/gameovertxt.png');
    }

    create()
    {
        var anim = this.anims.create({
          key: 'gameover',
          frames: this.anims.generateFrameNumbers('gameoversheet', { start: 0, end: 56 }),
          frameRate: 15,
          repeat: 0
        });
        var gameover = this.add.sprite(355, 287, 'gameoversheet').play('gameover');
        gameover.displayWidth = 770;
        gameover.scaleY = gameover.scaleX;

        this.add.image(355, 287, 'gameovertxt');

        gameover.on('animationcomplete', function(animation, frame) {
          this.scene.start('SceneA');
        }, this);
    }

    update()
    {
    }
  }

  var config = {
      type: Phaser.AUTO,
      width: 740,
      height: 580,
      physics: {
          default: 'arcade',
          arcade: {
              gravity: { y: 200 }
          }
      },
      scene: [ SceneA, SceneB, SceneC ]
  };
  var game = new Phaser.Game(config);
    </script>

</body>
</html>
